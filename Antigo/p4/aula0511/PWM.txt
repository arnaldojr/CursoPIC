;ESTE PROGRAMA ALTERA O VALOR DA LARGURA DE PULSO DO SINAL DO PWM

#INCLUDE<P16F877A.INC>

 org 0x00
 GOTO INICIO

 ORG 0XF0

 VAR1 EQU 20H
 VAR2 EQU 21H
;Variaveis para Delay:
 REG1 EQU 22H
 REG2 EQU 23H
 CONT EQU 24H

 INICIO

 BSF STATUS,RP0
 BCF STATUS,RP1
 MOVLW B'11111111'
 MOVWF TRISA
 MOVLW B'00001111'
 MOVWF TRISB
 MOVLW B'11111001'
 MOVWF TRISC
 MOVLW 0X00
 MOVWF TRISD
 MOVWF TRISE
 MOVLW .7
 MOVWF ADCON1 ;DESABILITA ENTRADAS ANALOGICAS  MOVLW B'10000000'
 MOVWF OPTION_REG
 BCF STATUS,RP0

 MOVLW B'00001111' 
 MOVWF CCP1CON ;HABILITA PWM1
 MOVWF CCP2CON ;HABILITA PWM2
 MOVLW B'00001111'
 MOVWF CCPR1L ;0%
 CLRF CCPR2L ;0%
 BSF STATUS,RP0
 MOVLW 0xFF
 MOVWF PR2 ;RESOLUÇÃO DE 10 BITS
 BCF STATUS,RP0
 BSF T2CON,TMR2ON ;TIMER LIGADO
 MOVLW .0
 MOVWF VAR1
 MOVLW .0
 MOVWF VAR2

 LOOP
 BTFSS PORTB,3 ;TESTE BOTÃO1
 CALL BOTAO1
 BTFSS PORTB,2 ;TESTE BOTÃO2
 CALL BOTAO2
 BTFSS PORTB,1 ;TESTE BOTÃO3
 CALL BOTAO3
 BTFSS PORTB,0 ;TESTE BOTÃO4
 CALL BOTAO4
 GOTO LOOP


 BOTAO1 ;INCREMENTO GROSSO DA LARGURA DE PULSO (10%)
 MOVLW .100
 ADDWF VAR1,F ;INCREMENTO DA PARTE BAIXA DO PWM (RESPOSAVEL POR 8 BITS)

 BTFSC	STATUS,C
 INCF VAR2,F ; INCREMENTO DA PARTE ALTA DO PWM (RESPOSAVEL POR 2 BITS)

 CALL ATUALIZA_PWM1

 CALL ATRASO_1S
 BTFSS PORTB,3
 GOTO $-1
 RETURN

 BOTAO2 ;DECREMENTO GROSSO DA LARGURA DE PULSO (10%)
 MOVLW .100
 SUBWF VAR1,F

 BTFSS	STATUS,C
 DECF VAR2,F

 CALL ATUALIZA_PWM1

 CALL ATRASO_1S
 BTFSS PORTB,2
 GOTO $-1
 RETURN

 BOTAO3 ;INCREMENTO FINO DA LARGURA DE PULSO (1%)
 MOVLW .10
 ADDWF VAR1,F

 BTFSC	STATUS,C
 INCF VAR2,F

 CALL ATUALIZA_PWM1

 CALL ATRASO_1S
 BTFSS PORTB,1
 GOTO $-1
 RETURN

 BOTAO4 ;DECREMENTO FINO DA LARGURA DE PULSO (1%)
 MOVLW .10
 SUBWF VAR1,F

 BTFSS	STATUS,C
 DECF VAR2,F

 CALL ATUALIZA_PWM1

 CALL ATRASO_1S
 BTFSS PORTB,0
 GOTO $-1
 RETURN

 ATUALIZA_PWM1 ;ATUALIZA O VALOR DA LARGURA DE PULSO DO PWM.
 BTFSC VAR1,0
 BSF CCP1CON,4
 BTFSS VAR1,0
 BCF CCP1CON,4

 BTFSC VAR1,1
 BSF CCP1CON,5
 BTFSS VAR1,1
 BCF CCP1CON,5

 BTFSC VAR1,2
 BSF CCPR1L,0
 BTFSS VAR1,2
 BCF CCPR1L,0

 BTFSC VAR1,3
 BSF CCPR1L,1
 BTFSS VAR1,3
 BCF CCPR1L,1

 BTFSC VAR1,4
 BSF CCPR1L,2
 BTFSS VAR1,4
 BCF CCPR1L,2

 BTFSC VAR1,5
 BSF CCPR1L,3
 BTFSS VAR1,5
 BCF CCPR1L,3

 BTFSC VAR1,6
 BSF CCPR1L,4
 BTFSS VAR1,6
 BCF CCPR1L,4

 BTFSC VAR1,7
 BSF CCPR1L,5
 BTFSS VAR1,7
 BCF CCPR1L,5

 BTFSC VAR2,0
 BSF CCPR1L,6
 BTFSS VAR2,0
 BCF CCPR1L,6

 BTFSC VAR2,1
 BSF CCPR1L,7
 BTFSS VAR2,1
 BCF CCPR1L,7
 RETURN



 ATRASO_1MS
 MOVLW .255
 MOVWF REG1
 VOLTA
 DECF REG1,F
 BTFSS STATUS,Z
 GOTO VOLTA
 RETURN

 ATRASO_1S
 MOVLW .255
 MOVWF CONT
 VOLT
 CALL ATRASO_1MS
DECF CONT,F
 BTFSS STATUS,Z
 GOTO VOLT
 RETURN




 END
