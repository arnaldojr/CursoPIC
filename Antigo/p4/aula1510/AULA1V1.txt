#INCLUDE<P16F877A.INC>
 
 REG1 EQU 20H
 REG2 EQU 21H
 
INICIO
 BSF  STATUS,RP0 ; CONFIGURA??O DE PORTAS
 BCF  STATUS,RP1
 MOVLW B'11111111' 
 MOVWF TRISA
 MOVLW B'00001111'
 MOVWF TRISB
 MOVLW B'11111001'
 MOVWF TRISC
 MOVLW 0X00
 MOVWF TRISD
 MOVWF TRISE
 MOVLW B'10000000'
 MOVWF OPTION_REG
 BCF  STATUS,RP0
 MOVLW B'10000000'
 MOVWF PORTB
 MOVLW .0
 MOVWF PORTD
 
LOOP      ; TESTE DE BOT?O
 BTFSS PORTB,1  ; TESTA PORTB1 E PULA PARA A PR?XIMA 
      ; SE O BIT FOR '1'
 CALL  BOT1
 BTFSS PORTB,2  ; TESTE BOT?O 2
 CALL BOT2
 BTFSS PORTB,3  ; TESTE BOT?O 3
 CALL BOT3
 GOTO LOOP
 
BOT1     ; ROTINA DO BOT?O
 INCF PORTD,F 
 CALL ATRASO  ; ROTINA DE ATRASO
 BTFSS PORTB,1  ; BOT?O PRESO
 GOTO $-1
 CALL ATRASO  ; 50ms
 RETURN
 
BOT2
 DECF PORTD,F
 CALL ATRASO
 BTFSS PORTB,2
 GOTO $-1
 CALL ATRASO
 RETURN
 
BOT3
 MOVLW .0
 MOVWF PORTD
 CALL ATRASO
 BTFSS PORTB,3
 GOTO $-1
 CALL ATRASO
 RETURN
 
ATRASO
 MOVLW .255   ;W RECEBE 255
 MOVWF REG1  ;REG1 RECEBE 2
VOLTA
 CALL ATRASO1
 DECF REG1,F   ;REG1 RECEBE REG1 -1
 BTFSS STATUS,Z ;Pula a proxima instrucao se Z for 1
 GOTO VOLTA  ;Pula para Volta 
 RETURN     ;Retorna
 
 
ATRASO1
 MOVLW .255  ;W RECEBE 250
 MOVWF REG2  ;REG1 RECEBE 2
VOLTA1
 DECF REG2,F   ;REG1 RECEBE REG1 -1
 BTFSS STATUS,Z ;Pula a proxima instrucao se Z for 1
 GOTO VOLTA1  ;Pula para Volta 
 RETURN 


; só pediu para copiar daqui para baixo nesta aula! Tudo o que for anterior era da outra aula (p3)

ESCREVE_COMANDO   ; ENVIA COMANDO AO LCD
 BCF  PORTE,0  ; SINAL DE COMANDO
 NOP
 MOVWF PORTD  ; INFORMAÇÃO DA PORTA D
 NOP
 NOP
 BSF  PORTE,1  ; PULSO DE ENABLE 
 NOP
 NOP
 BCF  PORTE,1
 CALL ATRASO ; ATRASO 1ms
 RETURN

ESCREVE_DADO   ; ESCREVE CARACTERES NO LCD
 BSF  PORTE,0  ; SINAL DE DADO / CARACTERE
 NOP
 MOVWF PORTD  ; INFORMAÇÃO DA PORTA D
 NOP
 NOP
 BSF  PORTE,1  ; PULSO DE ENABLE
 NOP
 NOP
 BCF  PORTE,1
 CALL ATRASO ; ATRASO DE 1ms
 RETURN

INICIA_LCD   ; CONFIGURAÇÃO INICIAL DO LCD
 MOVLW 0X38
 CALL ESCREVE_COMANDO
 CALL ATRASO_3MS
 MOVLW 0X38
 CALL ESCREVE_COMANDO
 MOVLW 0X0C
 CALL ESCREVE_COMANDO
 MOVLW 0X06
 CALL ESCREVE_COMANDO
 MOVLW 0X01
 CALL ESCREVE_COMANDO
 CALL ATRASO
 RETURN
END 
