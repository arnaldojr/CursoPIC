;PROGRAMA QUE CONVERTE O NÍVEL DE TENSÃO ANALOGICO DO SENSOR DE TEMPERATURA
(RA0) QUE ESQUENTA PELO PWM PARA DIGITAL 10 BITS E EXIBE NO DISPLAY

 #INCLUDE<P16F877A.INC>

 org 0x00
 GOTO INICIO

 ORG 0XF0

 REG1 EQU 20H
 REG2 EQU 21H
 CONT EQU 22H
 CH0L EQU 23H
 CH0H EQU 24H
 VAR1 EQU 25H
 VAR2 EQU 26H
 TEST EQU 27H
 

 INICIO
 BSF STATUS,RP0
 BCF STATUS,RP1
 MOVLW B'11111111'
 MOVWF TRISA
 MOVLW B'00001111'
 MOVWF TRISB
 MOVLW B'11111001'
 MOVWF TRISC
 MOVLW 0X00
 MOVWF TRISD
 MOVWF TRISE
 MOVLW B'10000010'
 MOVWF ADCON1 ;HABILITA ENTRADAS ANALOGICAS!
 MOVLW B'10000000'
 MOVWF OPTION_REG
 BCF STATUS,RP0
 MOVLW B'01000001'
 MOVWF ADCON0
 CALL ATRASO_1S
 CALL INICIA_LCD
 MOVLW 0X00
 MOVWF CH0L
 MOVWF CH0H

 MOVLW B'00001111' 
 MOVWF CCP1CON ;HABILITA PWM1
 MOVLW B'00001111'
 MOVWF CCPR1L ;0%
 CLRF CCPR2L ;0%
 BSF STATUS,RP0
 MOVLW 0xFF
 MOVWF PR2 ;RESOLUÇÃO DE 10 BITS
 BCF STATUS,RP0
 BSF T2CON,TMR2ON ;TIMER LIGADO
 MOVLW .0
 MOVWF VAR1
 MOVLW .0
 MOVWF VAR2


 LOOP

 MOVLW 0X80
 CALL ESCREVE_COMANDO
 CALL LER_ADC
 CALL ESCREVE_ADC
 CALL ATRASO_1MS

 BTFSS PORTB,3 ;TESTE BOTÃO1
 CALL BOTAO1
 BTFSS PORTB,2 ;TESTE BOTÃO2
 CALL BOTAO2
 BTFSS PORTB,1 ;TESTE BOTÃO3
 CALL BOTAO3
 BTFSS PORTB,0 ;TESTE BOTÃO4
 CALL BOTAO4

 CALL TEST_ADC_LOW_LIGA
 CALL TEST_ADC_LOW_DESLIGA

GOTO LOOP

TEST_ADC_LOW_LIGA
 MOVF VAR1,W
 MOVWF TEST
 MOVLW B'00111111'
 SUBWF TEST,W
 BTFSC STATUS,Z
 CALL TEST_ADC_HIGH_LIGA
RETURN

TEST_ADC_HIGH_LIGA
 MOVF VAR2,W
 MOVWF TEST
 MOVLW B'00000000'
 SUBWF TEST,W
 BTFSC STATUS,Z
 CALL LIGA_COOLER
RETURN

TEST_ADC_LOW_DESLIGA
 MOVF VAR1,W
 MOVWF TEST
 MOVLW B'00001111'
 SUBWF TEST,W
 BTFSC STATUS,Z
 CALL TEST_ADC_HIGH_DESLIGA
RETURN

TEST_ADC_HIGH_DESLIGA
 MOVF VAR2,W
 MOVWF TEST
 MOVLW B'00000000'
 SUBWF TEST,W
 BTFSC STATUS,Z
 CALL DESLIGA_COOLER
RETURN

LIGA_COOLER
	MOVLW	B'11111111'
	MOVWF	CCPR2L
RETURN

DESLIGA_COOLER
	MOVLW	B'00000000'
	MOVWF	CCPR2L
RETURN



BOTAO1 ;AUMENTA MUITO O VALOR DO PWM1
 
 MOVLW .100
 ADDWF VAR1,F

 BTFSC STATUS,C
 INCF VAR2,F

 CALL ATUALIZA_PWM1

 CALL ATRASO_1S
 BTFSS PORTB,3
 GOTO $-1
 RETURN

 BOTAO2 ;DIMINUI MUITO O VALOR DO PWM1
 MOVLW .100
 SUBWF VAR1,F

 BTFSS STATUS,C
 DECF VAR2,F

 CALL ATUALIZA_PWM1

 CALL ATRASO_1S
 BTFSS PORTB,2
 GOTO $-1
 RETURN

 BOTAO3 ;AUMENTA O VALOR DO PWM1
 MOVLW .10
 ADDWF VAR1,F

 BTFSC STATUS,C
 INCF VAR2,F

 CALL ATUALIZA_PWM1

 CALL ATRASO_1S
 BTFSS PORTB,1
 GOTO $-1
 RETURN

 BOTAO4 ;DIMINUI O VALOR DO PWM1
 MOVLW .10
 SUBWF VAR1,F

 BTFSS STATUS,C
 DECF VAR2,F

 CALL ATUALIZA_PWM1

 CALL ATRASO_1S
 BTFSS PORTB,0
 GOTO $-1
 RETURN

 ATUALIZA_PWM1 ;ATUALIZA O VALOR DA LARGURA DE PULSO DO PWM.
 BTFSC VAR1,0
 BSF CCP1CON,4
 BTFSS VAR1,0
 BCF CCP1CON,4

 BTFSC VAR1,1
 BSF CCP1CON,5
 BTFSS VAR1,1
 BCF CCP1CON,5

 BTFSC VAR1,2
 BSF CCPR1L,0
 BTFSS VAR1,2
 BCF CCPR1L,0

 BTFSC VAR1,3
 BSF CCPR1L,1
 BTFSS VAR1,3
 BCF CCPR1L,1

 BTFSC VAR1,4
 BSF CCPR1L,2
 BTFSS VAR1,4
 BCF CCPR1L,2

 BTFSC VAR1,5
 BSF CCPR1L,3
 BTFSS VAR1,5
 BCF CCPR1L,3

 BTFSC VAR1,6
 BSF CCPR1L,4
 BTFSS VAR1,6
 BCF CCPR1L,4

 BTFSC VAR1,7
 BSF CCPR1L,5
 BTFSS VAR1,7
 BCF CCPR1L,5

 BTFSC VAR2,0
 BSF CCPR1L,6
 BTFSS VAR2,0
 BCF CCPR1L,6

 BTFSC VAR2,1
 BSF CCPR1L,7
 BTFSS VAR2,1
 BCF CCPR1L,7
 RETURN

 ESCREVE_ADC

 BTFSC CH0H,1
 CALL ESCREVE_1
 BTFSS CH0H,1
 CALL ESCREVE_0

 BTFSC CH0H,0
 CALL ESCREVE_1
 BTFSS CH0H,0
 CALL ESCREVE_0

 BTFSC CH0L,7
 CALL ESCREVE_1
 BTFSS CH0L,7
 CALL ESCREVE_0

 BTFSC CH0L,6
 CALL ESCREVE_1
 BTFSS CH0L,6
 CALL ESCREVE_0

 BTFSC CH0L,5
 CALL ESCREVE_1
 BTFSS CH0L,5
 CALL ESCREVE_0

 BTFSC CH0L,4
 CALL ESCREVE_1
 BTFSS CH0L,4
 CALL ESCREVE_0

 BTFSC CH0L,3
 CALL ESCREVE_1
 BTFSS CH0L,3
 CALL ESCREVE_0

 BTFSC CH0L,2
 CALL ESCREVE_1
 BTFSS CH0L,2
 CALL ESCREVE_0

 BTFSC CH0L,1
 CALL ESCREVE_1
 BTFSS CH0L,1
 CALL ESCREVE_0

 BTFSC CH0L,0
 CALL ESCREVE_1
 BTFSS CH0L,0
 CALL ESCREVE_0

 RETURN

 ESCREVE_0
 MOVLW '0'
 CALL ESCREVE_DADO
 RETURN

 ESCREVE_1
 MOVLW '1'
 CALL ESCREVE_DADO
 RETURN

 LER_ADC
 BSF ADCON0,GO
 BTFSC ADCON0,GO
 GOTO $-1
 BSF STATUS,RP0
 MOVF ADRESL,W
 BCF STATUS,RP0
 MOVWF CH0L
 MOVF ADRESH,W
 MOVWF CH0H
 RETURN



 INICIA_LCD
 MOVLW 0X38
 CALL ESCREVE_COMANDO
 CALL ATRASO_1MS
 CALL ATRASO_1MS
 CALL ATRASO_1MS
 MOVLW 0X38
 CALL ESCREVE_COMANDO
 MOVLW 0X0C
 CALL ESCREVE_COMANDO
 MOVLW 0X06
 CALL ESCREVE_COMANDO
 MOVLW 0X01
 CALL ESCREVE_COMANDO
 CALL ATRASO_1MS
 RETURN

 ESCREVE_COMANDO ;ENVIA COMANDO AO LCD
 BCF PORTE,0 ;SINAL DE COMANDO
 NOP
 MOVWF PORTD ;INFORMAÇÃO NA PORTA D DE DAOD  NOP  NOP  BSF PORTE,1 ;PULSO DE ENABLE  NOP  NOP  BCF PORTE,1 CALL ATRASO_1MS ;ATRSO DE 1ms  RETURN

 ESCREVE_DADO ;ESCREVE CARACTERES NO LCD BSF PORTE,0 ;SINAL DE DADO  NOP  MOVWF PORTD ;INFORMAÇÃO NA PORTA D DE DAOD  NOP  NOP  BSF PORTE,1 ;PULSO DE ENABLE  NOP  NOP  BCF PORTE,1 CALL ATRASO_1MS ;ATRSO DE 1ms  RETURN 

ATRASO_1MS
 MOVLW .255
 MOVWF REG1
 VOLTA
 DECF REG1,F
 BTFSS STATUS,Z
 GOTO VOLTA
 RETURN

 ATRASO_1S
MOVLW .255
 MOVWF CONT
 VOLT
 CALL ATRASO_1MS
DECF CONT,F
 BTFSS STATUS,Z
 GOTO VOLT
 RETURN

 END

