//programa que conta e mostra numeros no lcd, incrementa, decrementa e zera conforme o display

#INCLUDE<P16F877A.INC>

 org 0x00
 GOTO INICIO

 ORG 0X10

 REG1 EQU 20H
 REG2 EQU 21H
 CONT EQU 22H
 REG  EQU 23H

 INICIO
 BSF STATUS,RP0
 BCF STATUS,RP1
 MOVLW B'11111111'
 MOVWF TRISA
 MOVLW B'00001111'
 MOVWF TRISB
 MOVLW B'11111001'
 MOVWF TRISC
 MOVLW 0X00
 MOVWF TRISD
 MOVWF TRISE
 MOVLW .7
 MOVWF ADCON1 ;DESABILITA ENTRADAS ANALOGICAS  MOVLW B'10000000'
 MOVWF OPTION_REG
 BCF STATUS,RP0
 CALL ATRASO_1S
 CALL INICIA_LCD
 MOVLW .0
 MOVWF REG
MOVLW	0X80
CALL	ESCREVE_COMANDO
MOVLW	'0'
CALL	ESCREVE_DADO
 
 LOOP
 BTFSS PORTB,3 ;TESTE BOTÃO1
 CALL BOT1
 BTFSS PORTB,2 ;TESTE BOTÃO1
 CALL BOT2
 BTFSS PORTB,1 ;TESTE BOTÃO1
 CALL BOT3
 GOTO LOOP



BOT1
	INCF REG,F
	CALL LIMITADOR
	MOVLW	0X80
	CALL	ESCREVE_COMANDO
	MOVF REG,W
	CALL DECODIFICADOR
	CALL ESCREVE_DADO
	CALL ATRASO_1S
	BTFSS	PORTB,3
	GOTO	$-1
	CALL ATRASO_1S
	RETURN

BOT2
	DECF REG,F
	CALL LIMITADOR2
	MOVLW	0X80
	CALL	ESCREVE_COMANDO
	MOVF REG,W
	CALL DECODIFICADOR
	CALL ESCREVE_DADO
	CALL ATRASO_1S
	BTFSS	PORTB,2
	GOTO	$-1
	CALL ATRASO_1S
	RETURN

BOT3
	MOVLW 0X80
	CALL ESCREVE_COMANDO
	MOVLW '0'
	CALL ESCREVE_DADO
	CLRF	REG
	CALL ATRASO_1S
	BTFSS	PORTB,1
	GOTO	$-1
	CALL ATRASO_1S
	RETURN
	

 INICIA_LCD
 MOVLW 0X38
 CALL ESCREVE_COMANDO
 CALL ATRASO_1MS
 CALL ATRASO_1MS
 CALL ATRASO_1MS
 MOVLW 0X38
 CALL ESCREVE_COMANDO
 MOVLW 0X0C
 CALL ESCREVE_COMANDO
 MOVLW 0X06
 CALL ESCREVE_COMANDO
 MOVLW 0X01
 CALL ESCREVE_COMANDO
 CALL ATRASO_1MS
 RETURN

 ESCREVE_COMANDO ;ENVIA COMANDO AO LCD
 BCF PORTE,0 ;SINAL DE COMANDO
 NOP
 MOVWF PORTD ;INFORMAÇÃO NA PORTA D DE DAOD  NOP  NOP  BSF PORTE,1 ;PULSO DE ENABLE  NOP  NOP  BCF PORTE,1 CALL ATRASO_1MS ;ATRSO DE 1ms  RETURN

 ESCREVE_DADO ;ESCREVE CARACTERES NO LCD BSF PORTE,0 ;SINAL DE DADO  NOP  MOVWF PORTD ;INFORMAÇÃO NA PORTA D DE DAOD  NOP  NOP  BSF PORTE,1 ;PULSO DE ENABLE  NOP  NOP  BCF PORTE,1 CALL ATRASO_1MS ;ATRSO DE 1ms  RETURN 

ATRASO_1MS
 MOVLW .255
 MOVWF REG1
 VOLTA
 DECF REG1,F
 BTFSS STATUS,Z
 GOTO VOLTA
 RETURN

 ATRASO_1S
 MOVLW .255
 MOVWF CONT
 VOLT
 CALL ATRASO_1MS
DECF CONT,F
 BTFSS STATUS,Z
 GOTO VOLT
 RETURN

DECODIFICADOR
	ADDWF PCL,F		;PC <- PC + W
	RETLW '0'		;CÓDIGO ASCII
	RETLW '1'
	RETLW '2'
	RETLW '3'
	RETLW '4'
	RETLW '5'
	RETLW '6'
	RETLW '7'
	RETLW '8'
	RETLW '9'

LIMITADOR //quando passa de 9 volta pro zero	
	MOVF REG,W		;W <- REG
	SUBLW .10		;W <- 10 - W
	BTFSC STATUS,Z
	CLRF REG		; REG <- 0
	RETURN

LIMITADOR2 //quando volta até o zero vai pro 9	
	MOVF REG,W		;W <- REG
	SUBLW 0xFF		;W <- FF - W
	BTFSS STATUS,Z
	RETURN
	MOVLW .9
	MOVWF REG 
	RETURN


 END

