#INCLUDE <P16F877A.INC> ; MICROCONTROLADOR UTILIZADO
; __CONFIG _BOREN_ON &_CP_OFF &_PWRTE_ON&_WDT_OFF &_LVP_OFF &_XT_OSC ;CONFIGURAÇÃO DOS FUSIVEIS
#DEFINE BANK0 BCF STATUS,RP0 ; SETA BANK 0 DE MEMORIA
#DEFINE BANK1 BSF STATUS,RP0 ; SETA BANK 1 DE MEMORIA
 
  CBLOCK 0X20
  W_TEMP
  STATUS_TEMP
  TEMPO1 ;DELAY
  TEMPO2 ;DELAY
  REG
  PWMH
  PWML
  VAR1
  VAR2
  TEMPO3
  TEMPO4
  UNIDADE
  DEZENA
  CENTENA
  RECEBEVOLT
  ADH ; AUXILIAR AD ALTO AN0
  ADL ; AUXILIAR AD BAIXO AN0
  AD8BITS ; RECEBE BIT A BIT OS 8 BITS DO AD
 ENDC
 
ORG     0X00 ;ENDEREÇO INICIAL DE PROCESSAMENTO
GOTO CONFIGURA
 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; CONFIGURAÇÃO DOS PORTS DO MICROCONTROLADOR
;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CONFIGURA
CLRF  PORTA
CLRF  PORTB
CLRF  PORTC       ; GARANTE TODAS AS SAIDAS EM ZERO
CLRF  PORTD
CLRF  PORTE
 
BANK1       ; ALTERA PARA BANCO 1
MOVLW B'11011111'    ; CONFIGURA I/O DO PORTA
MOVWF TRISA 
MOVLW B'00001111'    ; CONFIGURA I/O DO PORTB
MOVWF TRISB 
MOVLW B'11111001'    ; CONFIGURA I/O DO PORTC
MOVWF TRISC 
MOVLW B'00000000'    ; CONFIGURA I/O DO PORTD
MOVWF TRISD 
MOVLW B'00000000'    ; CONFIGURA I/O DO PORTE
MOVWF TRISE 
MOVLW  B'10000111'    ; CONFIGURA OPTION REG
MOVWF  OPTION_REG
MOVLW  B'00000000'    ; CONFIGURA INTCON
MOVWF  INTCON
MOVLW  B'10000111'    ; CONFIGURA ADCON1
MOVWF  ADCON1 
MOVLW  B'00000111'    ; CONFIGURA CMCON
MOVWF  CMCON
BANK0 
;INICIALIZAÇÃO DO PWM
MOVLW B'00001111'
MOVWF  CCP1CON   ; HABILITA PWM1
MOVWF   CCP2CON    ; HOBILITA PWM2
CLRF  CCPR1L    ; ZERA O PWM1 0%
CLRF  CCPR2L    ; ZERA O PWM2 0%
BANK1      ; BANCO1
MOVLW   0XFF
MOVWF   PR2      ; RESOLUÇÃO DE 10 BITS
BANK0     ; BANCO0
BSF  T2CON,TMR2ON  ; TIMER2 LIGADO
;CONFIGURAÇÃO CONVERSOR AD
MOVLW B'01000001'  ; CANAL 0 
MOVWF ADCON0   ; AD LIGADO
BANK1
MOVWF B'11000000'  ; 
MOVLW ADCON1
BANK0
GOTO  MAIN
 
 
;SUB-ROTINAS*********************************************************************************
 ;*********************************************************************************************
ATRASO_4MS
MOVLW .1
MOVWF TEMPO1
TEMPO_1
MOVLW .255
MOVWF TEMPO2
TEMPO_2
DECF TEMPO2,F
BTFSS STATUS,Z
 GOTO TEMPO_2
DECF TEMPO1,F
BTFSS STATUS,Z
GOTO TEMPO_1
RETURN
 
ATRASO_1S
MOVLW .255
MOVWF TEMPO3
TEMPO_3
MOVLW .255
MOVWF TEMPO4
TEMPO_4
DECF TEMPO4,F
BTFSS STATUS,Z
 GOTO TEMPO_4
DECF TEMPO3,F
BTFSS STATUS,Z
GOTO TEMPO_3
RETURN
 
 
ESCREVE_COMANDO   ;ENVIA COMANDO AO LCD
BCF  PORTE,0   ;SINAL DE COMANDO
NOP
MOVWF PORTD   ;INFORMAÇÃO NA PORTA D
NOP
 NOP
BSF  PORTE,1   ;PULSO DE ENABLE
NOP
NOP
BCF  PORTE,1
CALL ATRASO_4MS  ;ATRASO DE 1mS
RETURN
ESCREVE_DADO   ;ESCREVE CARACTERES NO LCD
BSF  PORTE,0
NOP
MOVWF PORTD   ;INFORMAÇÃO NA PORTA D
 NOP
NOP
BSF  PORTE,1   ;PULSO DE ENABLE
NOP
NOP
BCF  PORTE,1
CALL ATRASO_4MS  ;ATRASO 1mS
RETURN
;-------INICIALIZAÇÃO DO LCD----
INICIA_LCD
MOVLW 0X38
CALL ESCREVE_COMANDO
CALL ATRASO_1S
 MOVLW 0X38
CALL ESCREVE_COMANDO
MOVLW 0X0C
CALL ESCREVE_COMANDO
MOVLW 0X06
CALL ESCREVE_COMANDO
MOVLW 0X01
CALL ESCREVE_COMANDO
CALL ATRASO_1S
RETURN
;-----AMOSTRA CANAL0----------
CANAL0
;SELECIONA CANAL 0
MOVLW B'01000001'  ; CANAL 0 
MOVWF ADCON0   ; AD LIGADO
BANK1
MOVWF B'11000000'  ; 
MOVLW ADCON1
BANK0
CALL  ATRASO_4MS
RETURN
;-------AMOSTRA DO CANAL 1
CANAL1
MOVLW B'01001001'  ; CANAL 1 
MOVWF ADCON0   ; AD LIGADO
BANK1
MOVWF B'11000000'  ; 
MOVLW ADCON1
BANK0
CALL ATRASO_4MS
RETURN
;------COLETA AMOSTRA DO AD---
COLETAAD
BSF  ADCON0,GO
BTFSC ADCON0,GO
GOTO $-1
MOVF ADRESH,W
MOVWF ADH
BANK1 
MOVF ADRESL,W
BANK0
MOVWF ADL
RETURN
 
 
;CONVERTE PARA BINARIO O VALOR DO AD E EXIBE NO LCD
EXIBEBINARIO
BTFSC ADH,1
MOVLW '1'
BTFSS ADH,1
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADH,0
MOVLW '1'
BTFSS ADH,0
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADL,7
MOVLW '1'
BTFSS ADL,7
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADL,6
MOVLW '1'
BTFSS ADL,6
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADL,5
MOVLW '1'
BTFSS ADL,5
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADL,4
MOVLW '1'
BTFSS ADL,4
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADL,3
MOVLW '1'
BTFSS ADL,3
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADL,2
MOVLW '1'
BTFSS ADL,2
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADL,1
MOVLW '1'
BTFSS ADL,1
MOVLW '0'
CALL ESCREVE_DADO
BTFSC ADL,0
MOVLW '1'
BTFSS ADL,0
MOVLW '0'
CALL ESCREVE_DADO
RETURN

;-----------------CONVERTE O AD10 BITS E SALVA NO AD8BITS 
CONVERTE_AD
BTFSC ADH,1
BSF AD8BITS,7
BTFSS ADH,1
BCF AD8BITS,7
BTFSC ADH,0
BSF AD8BITS,6
BTFSS ADH,0
BCF AD8BITS,6
BTFSC ADL,7
BSF AD8BITS,5
BTFSS ADL,7
BCF AD8BITS,5
BTFSC ADL,6
BSF AD8BITS,4
BTFSS ADL,6
BCF AD8BITS,4
BTFSC ADL,5
BSF AD8BITS,3
BTFSS ADL,5
BCF AD8BITS,3
BTFSC ADL,4
BSF AD8BITS,2
BTFSS ADL,4
BCF AD8BITS,2
BTFSC ADL,3
BSF AD8BITS,1
BTFSS ADL,3
BCF AD8BITS,1
BTFSC ADL,2
BSF AD8BITS,0
BTFSS ADL,2
BCF AD8BITS,0
RETURN
 
;---------DECODIFICADOR LCD----
DECODIFICADOR
 ADDWF PCL,F ;PC<--PC+W
RETLW '0'  ;CODIGO ASCII
RETLW '1'
RETLW '2'
RETLW '3'
RETLW '4'
RETLW '5'
RETLW '6'
RETLW '7'
RETLW '8'
RETLW '9'
;----------PORCENTAGEM-----------
EXIBEVOLT
MOVLW .0
MOVWF UNIDADE
MOVWF DEZENA
MOVWF CENTENA
CALL CONVERTE_AD
MOVLW .0
SUBWF AD8BITS,W
BTFSS STATUS,Z
GOTO NAOEZERO ; ---SE FOR DIFERENTE DE ZERO
MOVF UNIDADE,W
CALL DECODIFICADOR
CALL ESCREVE_DADO
MOVF DEZENA,W
CALL DECODIFICADOR
CALL ESCREVE_DADO
MOVF CENTENA,W
CALL DECODIFICADOR
CALL ESCREVE_DADO
RETURN
NAOEZERO;;;;;;;;;;;;;;;;;;;;;;;;;;CONTINUAR DAQUI

INCF UNIDADE,F
INCF UNIDADE,F
MOVLW .10
SUBWF UNIDADE,W
BTFSS STATUS,Z
RETURN
MOVLW  .0
MOVWF UNIDADE
INCF DEZENA,F
MOVLW .10
SUBWF DEZENA,W
BTFSS STATUS,Z
RETURN
MOVLW  .0
MOVWF DEZENA
INCF CENTENA,F
MOVLW .1
SUBWF CENTENA,W
BTFSS STATUS,Z
RETURN
MOVLW .0
MOVWF UNIDADE
MOVWF DEZENA
MOVWF CENTENA
RETURN
 
 
 
;-------LIMITAR DE 0 ATE 9---------
 
MAIN
 MOVLW 0X00
 MOVWF REG
 MOVWF VAR1
 MOVWF VAR2  
 CALL ATRASO_4MS
 CALL INICIA_LCD
VOLTA2
 MOVLW 0X80    ;PRIMEIRA LINHA
 CALL ESCREVE_COMANDO
 MOVLW 'T'
 CALL ESCREVE_DADO
 MOVLW 'E'
 CALL ESCREVE_DADO
 MOVLW 'M'
 CALL ESCREVE_DADO
 MOVLW 'P'
 CALL ESCREVE_DADO
 MOVLW ':'
 CALL ESCREVE_DADO
 

; CALL CANAL0
; CALL COLETAAD
; CALL EXIBEBINARIO
 MOVLW 0XC0    ;SEGUNDA LINHA
 CALL ESCREVE_COMANDO
 MOVLW 'P'
 CALL ESCREVE_DADO
 MOVLW 'O'
 CALL ESCREVE_DADO
 MOVLW 'T'
 CALL ESCREVE_DADO
 MOVLW ':'
 CALL ESCREVE_DADO
 MOVLW ' '
 CALL ESCREVE_DADO

; CALL CANAL1
; CALL COLETAAD
; CALL EXIBEBINARIO

LOOP2
BTFSC PORTB,0  ;O BOTÃO 0 ESTÁ PRESSIONADO?
GOTO BOT2  ;NÃO, ENTÃO TRATA BOTÃO LIBERADO
GOTO INCREMENTA
BOT2
BTFSC PORTB,1  ; BOTÃO 1 ESTÁ PRESSIONADO?
 GOTO BOT3  ;NÃO, ENTÃO TRATA BOTÃO LIBERADO
GOTO DECREMENTA
BOT3
BTFSC PORTB,2  ;O BOTÃO 0 ESTÁ PRESSIONADO?
GOTO BOT4  ;NÃO, ENTÃO TRATA BOTÃO LIBERADO
GOTO INCREMENTA_10
BOT4
BTFSC PORTB,3  ; BOTÃO 1 ESTÁ PRESSIONADO?
 GOTO VOLTA2  ;NÃO, ENTÃO TRATA BOTÃO LIBERADO
GOTO DECREMENTA_10
;;;;;;;;;;;;;;;;;;;INCREMENTA----------------------
INCREMENTA
 ;MOVLW 0X01
 ;CALL ESCREVE_COMANDO
 ;CALL ATRASO_4MS
 ;MOVLW 0XC0    ;CURSOR DO DISPLAY NA SEGUNDA LINHA
 ;CALL ESCREVE_COMANDO
 ; MOVLW 'I'
 ;CALL ESCREVE_DADO
 ;MOVLW 'N'
 ;CALL ESCREVE_DADO
 ;MOVLW 'C'
 ;CALL ESCREVE_DADO
 ;MOVLW 'R'
 ;CALL ESCREVE_DADO
 ;MOVLW 'E'
 ;CALL ESCREVE_DADO
 ;MOVLW 'M'
 ; CALL ESCREVE_DADO
 ;MOVLW 'E'
 ;CALL ESCREVE_DADO
 ;MOVLW 'N'
 ;CALL ESCREVE_DADO
 ;MOVLW 'T'
 ;CALL ESCREVE_DADO
 ;MOVLW 'A'
 ;CALL ESCREVE_DADO
MOVF CCPR1L,W
MOVWF PWMH
 MOVLW .25
ADDWF PWMH,W
MOVWF CCPR1L 
;CALL ESCREVE_DADO
;INCF REG,F
;MOVF REG,W
;SUBLW .10
;BTFSC STATUS,Z
;CLRF REG
;MOVF REG,W
;CALL DECODIFICADOR
;CALL ESCREVE_DADO
CALL ATRASO_4MS
 GOTO    LOOP2
 
;;;;;;;;;;;;;;;DECREMENTA---------------------------------------
 
DECREMENTA
; MOVLW 0X01
; CALL ESCREVE_COMANDO
; CALL ATRASO_4MS
; MOVLW 0XC0    ;CURSOR DO DISPLAY NA SEGUNDA LINHA
; CALL ESCREVE_COMANDO
; MOVLW 'D'
; CALL ESCREVE_DADO
;  MOVLW 'E'
; CALL ESCREVE_DADO
; MOVLW 'C'
; CALL ESCREVE_DADO
; MOVLW 'R'
; CALL ESCREVE_DADO
; MOVLW 'E'
; CALL ESCREVE_DADO
; MOVLW 'M'
; CALL ESCREVE_DADO
; MOVLW 'E'
;  CALL ESCREVE_DADO
; MOVLW 'N'
; CALL ESCREVE_DADO
; MOVLW 'T'
; CALL ESCREVE_DADO
; MOVLW 'A'
; CALL ESCREVE_DADO
MOVF CCPR1L,W
MOVWF PWMH
MOVLW .25
SUBWF PWMH,W
MOVWF CCPR1L 
;CALL ESCREVE_DADO
;INCF REG,F
;MOVF REG,W
;SUBLW .10
;BTFSC STATUS,Z
;CLRF REG
;MOVF REG,W
;CALL DECODIFICADOR
;CALL ESCREVE_DADO
CALL ATRASO_4MS
GOTO    LOOP2
;;;;;;;;;;;;;;;;;;;INCREMENTA  10  ----------------------
 
INCREMENTA_10
 ;MOVLW 0X01
 ;CALL ESCREVE_COMANDO
 ;CALL ATRASO_4MS
 ;MOVLW 0XC0
 ;CALL ESCREVE_COMANDO
 ;MOVLW 'I'
 ;CALL ESCREVE_DADO
 ;MOVLW 'N'
 ;CALL ESCREVE_DADO
 ;MOVLW 'C'
 ;CALL ESCREVE_DADO
 ; MOVLW 'R'
 ;CALL ESCREVE_DADO
 ;MOVLW 'E'
 ;CALL ESCREVE_DADO
 ;MOVLW 'M'
 ;CALL ESCREVE_DADO
 ;MOVLW 'E'
 ;CALL ESCREVE_DADO
 ;MOVLW 'N'
 ;CALL ESCREVE_DADO
 ;MOVLW 'T'
 ; CALL ESCREVE_DADO
 ;MOVLW 'A'
 ;CALL ESCREVE_DADO
 ;MOVLW '1'
 ;CALL ESCREVE_DADO
 ;MOVLW '0'
 ;CALL ESCREVE_DADO
MOVLW .10
ADDWF VAR1,F
BTFSC STATUS,C
INCF VAR2,F
;COPIAR O RESULTADO PARA O REGISTRADOR BIT POR BIT
BTFSC VAR1,0
BSF  CCP1CON,4
BTFSS VAR1,0
BCF  CCP1CON,4
BTFSC VAR1,1
BSF  CCP1CON,5
BTFSS VAR1,1
BCF  CCP1CON,5
BTFSC VAR1,2
BSF  CCPR1L,0
BTFSS VAR1,2
BCF  CCPR1L,0
BTFSC VAR1,3
 BSF  CCPR1L,1
BTFSS VAR1,3
BCF  CCPR1L,1
BTFSC VAR1,4
BSF  CCPR1L,2
BTFSS VAR1,4
BCF  CCPR1L,2
BTFSC VAR1,5
BSF  CCPR1L,3
BTFSS VAR1,5
BCF  CCPR1L,3
BTFSC VAR1,6
BSF  CCPR1L,4
 BTFSS VAR1,6
BCF  CCPR1L,4
BTFSC VAR1,7
BSF  CCPR1L,5
BTFSS VAR1,7
BCF  CCPR1L,5
BTFSC VAR2,0
BSF  CCPR1L,6
BTFSS VAR2,0
BCF  CCPR1L,6
BTFSC VAR2,1
BSF  CCPR1L,7
BTFSS VAR2,1
 BCF  CCPR1L,7
CALL ATRASO_4MS
GOTO    LOOP2
 
;;;;;;;;;;;;;;;DECREMENTA   10---------------------------------------
 
DECREMENTA_10
 ;MOVLW 0X01
 ;CALL ESCREVE_COMANDO
 ;CALL ATRASO_4MS
 ;MOVLW 0XC0
 ;CALL ESCREVE_COMANDO
 ; MOVLW 'D'
 ;CALL ESCREVE_DADO
 ;MOVLW 'E'
 ;CALL ESCREVE_DADO
 ;MOVLW 'C'
 ;CALL ESCREVE_DADO
 ;MOVLW 'R'
 ;CALL ESCREVE_DADO
 ;MOVLW 'E'
 ;CALL ESCREVE_DADO
 ;MOVLW 'M'
 ; CALL ESCREVE_DADO
 ;MOVLW 'E'
 ;CALL ESCREVE_DADO
 ;MOVLW 'N'
 ;CALL ESCREVE_DADO
 ;MOVLW 'T'
 ;CALL ESCREVE_DADO
 ;MOVLW 'A'
 ;CALL ESCREVE_DADO
 ;MOVLW '1'
 ;CALL ESCREVE_DADO
 ; MOVLW '0'
 ;CALL ESCREVE_DADO
MOVLW .10
SUBWF VAR1,F
BTFSC STATUS,Z
DECF VAR2,F
;COPIAR O RESULTADO PARA O REGISTRADOR BIT POR BIT
BTFSC VAR1,0
BSF  CCP1CON,4
BTFSS VAR1,0
BCF  CCP1CON,4
 
BTFSC VAR1,1
BSF  CCP1CON,5
BTFSS VAR1,1
BCF  CCP1CON,5
BTFSC VAR1,2
BSF  CCPR1L,0
BTFSS VAR1,2
BCF  CCPR1L,0
BTFSC VAR1,3
BSF  CCPR1L,1
BTFSS VAR1,3
BCF  CCPR1L,1
BTFSC VAR1,4
 BSF  CCPR1L,2
BTFSS VAR1,4
BCF  CCPR1L,2
BTFSC VAR1,5
BSF  CCPR1L,3
BTFSS VAR1,5
BCF  CCPR1L,3
BTFSC VAR1,6
BSF  CCPR1L,4
BTFSS VAR1,6
BCF  CCPR1L,4
BTFSC VAR1,7
BSF  CCPR1L,5
 BTFSS VAR1,7
BCF  CCPR1L,5
BTFSC VAR2,0
BSF  CCPR1L,6
BTFSS VAR2,0
BCF  CCPR1L,6
BTFSC VAR2,1
BSF  CCPR1L,7
BTFSS VAR2,1
BCF  CCPR1L,7
CALL ATRASO_4MS
GOTO    LOOP2
 
 END
;RC2 COOLER
;RC1 RESISTOR